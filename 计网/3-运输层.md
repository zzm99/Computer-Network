# 运输层

1. 运输层协议为运行在不同主机上的应用进程之间提供了逻辑通信功能。
2. 应用进程使用运输层提供的逻辑通信功能能彼此发送报文，而无须考虑承载这些报文的物理基础设施的细节。
3. 运输层协议是在端系统中而不是在路由器中实现的。
4. 网络路由器仅作用于该数据报的网络层字段，即它们不检查封装在该数据报的运输层报文段的字段。在接收端，网络层从数据报中提取运输层报文段，并将该报文段向上交给运输层。运输层则处理接收到的报文段，使该报文段中的数据为接收应用进程使用。
5. 网络层提供了主机之间的逻辑通信，而运输层为运行在不同主机上的进程之间提供了逻辑通信。
6. 即使底层网络协议不能在网络层提供相应的服务，运输层协议也能提供某些服务。
7. 即使底层网络协议是不可靠的，也就是说网络层协议会使分组丢失、篡改和冗余，运输协议也能为应用程序提供可靠的数据传输服务。
8. 即使网络层不能保证运输层报文段的机密性，运输协议也能使用加密来确保应用程序报文不被入侵者读取。
9. 多路分解：将运输层报文段中的数据交付到正确的套接字。
10. 多路复用：在源主机从不同套接字中收集数据块，并为每个数据块封装上首部信息（这将在以后用于分解）从而生成报文段，然后将报文段传递到网络层。
11. 运输层多路复用要求：套接字有唯一标识符；每个报文段有特殊字段来指示该报文段所要交付到的套接字。
12. 运输层报文段组成：源端口号、目的端口号、其他首部字段、应用数据（报文）。
13. 在主机上的每个套接字能够分配一个端口号，当报文段到达主机时，运输层检查报文段中的目的端口号，并将其定向到相应的套接字。然后报文段中的数据通过套接字进入其所连接的进程。UDP大体是这样做的，TCP的多路复用与多路分解要复杂一些。
14. 一个UDP套接字是由一个二元组全面标识的，该二元组包含一个目的IP地址和一个目的端口号。因此，如果两个UDP报文段有不同的源IP地址和/或源端口号，但具有相同的目的IP地址和目的端口号，那么这两个报文段将通过相同的目的套接字被定向到相同的目的进程。
15. TCP套接字是由一个四元组（源IP地址，源端口号，目的IP地址，目的端口号）来标识的。当一个TCP报文段从网络到达一台主机时，该主机使用全部4个值来讲报文段定向分解到相应的套接字。特别与UDP不同的是，两个具有不同源IP地址或源端口号的到达TCP报文段将被定向到两个不同的套接字，除非TCP报文段携带了初始创建连接的请求。
16. UDP的好处：
    1.  关于发送什么数据以及何时发送的应用层控制更为精细。TCP有拥塞控制会遏制运输层TCP发送方。
    2.  无须连接建立。
    3.  无连接状态。
    4.  分组首部开销小。
17. TCP的拥塞控制会导致如因特网电话、视频会议之类的实时应用性能变得很差，由于这些原因，多媒体应用开发人员通常将这些应用运行在UDP之上而不是TCP之上。
18. 使用UDP的应用是可能实现可靠数据传输的。这可通过在应用程序自身中建立可靠性机制来完成。应用进程可以进行可靠通信，而无须受制于由TCP拥塞控制机制强加的传输速率限制。
19. 解决停等协议性能问题的方法：不以停等方式运行，允许发送方发送多个分组而无须等待确认。
20. 解决流水线的差错恢复有两种基本方法：回退N步GBN，选择重传SR。
21. 在回退N步协议中，允许发送方发送多个分组，而不需等待确认，但它也受限于在流水线中未确认的分组数不能超过某个最大允许数N。GBN协议也常被称为滑动窗口协议。
22. GBN发送方必须响应三种类型的事件：
    1.  上层的调用。
    2.  收到一个ACK。
    3.  超时事件。如果出现超时，发送方重传所有已发送但还未被确认过的分组。发送方仅使用一个定时器，它被当作是最早的已发送但未被确认的分组所使用的定时器。如果收到一个ACK，但仍有已发送但未被确认的分组，则定时器被重新启动，如果没有已发送但未被确认的分组，停止该定时器。
23. 在GBN协议中，接收方丢弃所有失序分组。尽管丢弃一个正确接收但失序的分组有点愚蠢和浪费，但是，接收方必须按序将数据交付给上层。接收方需要维护的唯一信息就是下一个按序接收的分组的序号。丢弃一个正确接收的分组的缺点是随后对该分组的重传也许会丢失或出错，因此甚至需要更多的重传。
24. 累积确认：对于未按序到达的分组，接收方丢弃该分组，并为最近按序接收的分组重新发送ACK。注意到因为一次交付到上层一个分组，如果分组k已接收并交付，则所有序号比k小的分组也已经交付。
25. GBN的性能问题：单个分组的差错就能够引起GBN重传大量分组，许多分组根本没有必要重传。
26. 选择重传SR协议通过让发送方仅重传那些它怀疑在接收方出错（即丢失或受损）的分组而避免了不必要的重传。
27. 这种个别的、按需的重传要求接收方逐个地确认正确接收地分组。
28. SR接收方将确认一个正确接收地分组而不管其是否按序。失序地分组将被缓存直到所有丢失分组（即序号更小的分组）皆被收到为止，这时才可以将一批分组按序交付给上层。
29. TCP“连接”是一条逻辑连接，中间路由器对TCP连接完全视而不见，它们看到的是数据报，而不是连接。
30. TCP连接提供的是全双工服务。TCP连接也是点对点point-to-point的，即单个发送方与单个接收方之间的连接。
31. TCP连接的组成包括：一台主机上的缓存、变量和与进程连接的套接字，以及另一台主机上的另一组缓存、变量和与进程连接的套接字。
32. 一个报文段的序号是该报文段首字节的字节流编号。
33. 主机A填充进报文段的确认号是主机A期望从主机B收到的下一字节的序号。
34. TCP在IP不可靠的尽力而为服务之上创建了一种可靠数据传输服务。TCP的可靠数据传输服务确保一个进程从其接收缓存中读出的数据流是无损坏、无间隙、非冗余和按序的数据流；即该字节流与连接的另一方端系统发送出的字节流是完全相同。
35. 每次TCP重传时都会将下一次的超时间隔设为先前值得两倍。在拥塞的时候，如果源持续重传分组，会使拥塞更加严重。相反，TCP使用更文雅的方式，每个发送方的重传都是经过越来越长的时间间隔后进行的。
36. 快速重传：超时触发重传存在问题之一是超时周期可能相对较长。发送方可在超时时间发生之前通过注意所谓冗余ACK来较好地检测到丢包情况。冗余ACK就是再次确认某个报文段地ACK而发送方先前已经收到对该报文段地确认。
37. 发送冗余ACK：比期望序号大的失序报文段到达，检测出间隔。
38. 一旦收到3个冗余的ACK，TCP就执行快速重传，即在该报文段的定时器过期之前重传丢失的报文段。
39. TCP确认是累积式的，正确接收但失序的报文段是不会被接收方逐个确认的。许多TCP实现会将正确接收但失序的报文段缓存起来。
40. TCP的差错恢复机制最好被分类为GBN协议与SR协议的混合体。
41. TCP为它的应用程序提供了流量控制服务（拥塞控制）。通过让发送方维护一个称为接收窗口的变量来提供流量控制。
42. 拥塞控制方法：
    1.  端到端拥塞控制：端系统通过对网络行为的观察如分组丢失和时延来判断。
    2.  网络辅助的拥塞控制：路由器向发送方提供关于网络中拥塞状态的显式反馈意见。
43. 一个丢失的报文段表意味着拥塞，应当降低TCP发送方的速率。
44. 一个确认报文段指示该网络正在向接收方交付发送方的报文段，能够增加发送方的速率。
45. TCP拥塞控制算法：慢启动；拥塞避免；快速恢复。前两者为强制部分，第三个为推荐部分。